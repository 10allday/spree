{"version":3,"file":"spree_frontend.js","sources":["../app/javascript/controllers/coupon_code_controller.js","../app/javascript/index.js"],"sourcesContent":["import { Controller } from 'stimulus'\n\nexport default class extends Controller {\n  static targets = [ 'code', 'resultText', 'resultIcon' ]\n\n  get code() {\n    return this.codeTarget.value.trim()\n  }\n\n  set code(value) {\n    this.codeTarget.value = value\n  }\n\n  initialize() {\n    this.apiClient = window.SpreeSDK.makeClient({\n      host: window.SpreeAPI.storefrontHost\n    })\n  }\n\n  async apply() {\n    if (!this.code) return\n\n    const orderToken = window.SpreeAPI.orderToken\n\n    const response = await this.apiClient.cart.applyCouponCode({ orderToken }, {\n      coupon_code: this.code\n    })\n\n    this.handleResponse(response)\n  }\n\n  async remove() {\n    if (!this.code) return\n\n    const orderToken = window.SpreeAPI.orderToken\n\n    const response = await this.apiClient.cart.removeCouponCode({ orderToken }, this.code)\n\n    this.handleResponse(response)\n  }\n\n  handleResponse(response) {\n    if (response.isFail()) {\n      this.handleError(response.fail().serverResponse.data.error)\n    } else {\n      this.handleSuccess()\n    }\n  }\n\n  handleError(error) {\n    this.code = null\n    this.element.classList.add('error')\n    this.resultTextTarget.classList.add('alert-error')\n    this.resultTextTarget.innerHTML = error\n    this.resultIconTarget.src = Spree.translations.coupon_code_error_icon\n  }\n\n  handleSuccess() {\n    this.code = null\n    this.element.classList.remove('error')\n    this.resultTextTarget.classList.remove('alert-error')\n    this.resultIconTarget.remove()\n    this.resultTextTarget.classList.add('alert-success')\n    this.resultTextTarget.innerHTML = Spree.translations.coupon_code_applied\n    window.location.reload()\n  }\n}\n","import { Application } from \"stimulus\"\nimport * as Controllers from './controllers'\nimport '@spree/storefront-api-v2-sdk/dist/client'\n\nconst application = Application.start()\napplication.register('coupon-code', Controllers.CouponCodeController)\n\nexport default {\n  start() {\n    console.log('Spree Frontend initialized')\n  }\n}\n\n"],"names":["initialize","this","apiClient","window","SpreeSDK","makeClient","host","SpreeAPI","storefrontHost","apply","_this2","code","orderToken","cart","applyCouponCode","coupon_code","response","handleResponse","remove","_this4","removeCouponCode","isFail","handleError","fail","serverResponse","data","error","handleSuccess","element","classList","add","resultTextTarget","innerHTML","resultIconTarget","src","Spree","translations","coupon_code_error_icon","coupon_code_applied","location","reload","codeTarget","value","trim","Controller","targets","Application","start","register","Controllers","console","log"],"mappings":"mWAaEA,WAAA,WACEC,KAAKC,UAAYC,OAAOC,SAASC,WAAW,CAC1CC,KAAMH,OAAOI,SAASC,oBAIpBC,2BACCR,KAAL,IAAKS,EAAKC,KAAM,yBAEhB,IAAMC,EAAaT,OAAOI,SAASK,WAHvB,uBAKWF,EAAKR,UAAUW,KAAKC,gBAAgB,CAAEF,WAAAA,GAAc,CACzEG,YAAaL,EAAKC,sBADdK,GAINN,EAAKO,eAAeD,2CAGhBE,4BACCjB,KAAL,IAAKkB,EAAKR,KAAM,yBAEhB,IAAMC,EAAaT,OAAOI,SAASK,WAHtB,uBAKUO,EAAKjB,UAAUW,KAAKO,iBAAiB,CAAER,WAAAA,GAAcO,EAAKR,qBAA3EK,GAENG,EAAKF,eAAeD,2CAGtBC,eAAA,SAAeD,GACTA,EAASK,SACXpB,KAAKqB,YAAYN,EAASO,OAAOC,eAAeC,KAAKC,OAErDzB,KAAK0B,mBAITL,YAAA,SAAYI,GACVzB,KAAKU,KAAO,KACZV,KAAK2B,QAAQC,UAAUC,IAAI,SAC3B7B,KAAK8B,iBAAiBF,UAAUC,IAAI,eACpC7B,KAAK8B,iBAAiBC,UAAYN,EAClCzB,KAAKgC,iBAAiBC,IAAMC,MAAMC,aAAaC,0BAGjDV,cAAA,WACE1B,KAAKU,KAAO,KACZV,KAAK2B,QAAQC,UAAUX,OAAO,SAC9BjB,KAAK8B,iBAAiBF,UAAUX,OAAO,eACvCjB,KAAKgC,iBAAiBf,SACtBjB,KAAK8B,iBAAiBF,UAAUC,IAAI,iBACpC7B,KAAK8B,iBAAiBC,UAAYG,MAAMC,aAAaE,oBACrDnC,OAAOoC,SAASC,8BA3DlB,WACE,YAAYC,WAAWC,MAAMC,YAG/B,SAASD,GACPzC,KAAKwC,WAAWC,MAAQA,8LARCE,gBACpBC,QAAU,CAAE,OAAQ,aAAc,cCCvBC,cAAYC,QACpBC,SAAS,cAAeC,kBAErB,CACbF,iBACEG,QAAQC,IAAI"}