!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("stimulus"),require("@spree/storefront-api-v2-sdk/dist/client")):"function"==typeof define&&define.amd?define(["stimulus","@spree/storefront-api-v2-sdk/dist/client"],t):(e||self).frontend=t(e.stimulus)}(this,function(e){function t(e,r){return(t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,r)}var r=function(e){var r,o;function n(){return e.apply(this,arguments)||this}o=e,(r=n).prototype=Object.create(o.prototype),r.prototype.constructor=r,t(r,o);var i,s=n.prototype;return s.initialize=function(){this.apiClient=window.SpreeSDK.makeClient({host:window.SpreeAPI.storefrontHost})},s.apply=function(){try{var e=this;if(!e.code)return Promise.resolve();var t=window.SpreeAPI.orderToken;return Promise.resolve(e.apiClient.cart.applyCouponCode({orderToken:t},{coupon_code:e.code})).then(function(t){e.handleResponse(t)})}catch(e){return Promise.reject(e)}},s.remove=function(){try{var e=this;if(!e.code)return Promise.resolve();var t=window.SpreeAPI.orderToken;return Promise.resolve(e.apiClient.cart.removeCouponCode({orderToken:t},e.code)).then(function(t){e.handleResponse(t)})}catch(e){return Promise.reject(e)}},s.handleResponse=function(e){e.isFail()?this.handleError(e.fail().serverResponse.data.error):this.handleSuccess()},s.handleError=function(e){this.code=null,this.element.classList.add("error"),this.resultTextTarget.classList.add("alert-error"),this.resultTextTarget.innerHTML=e,this.resultIconTarget.src=Spree.translations.coupon_code_error_icon},s.handleSuccess=function(){this.code=null,this.element.classList.remove("error"),this.resultTextTarget.classList.remove("alert-error"),this.resultIconTarget.remove(),this.resultTextTarget.classList.add("alert-success"),this.resultTextTarget.innerHTML=Spree.translations.coupon_code_applied,window.location.reload()},(i=[{key:"code",get:function(){return this.codeTarget.value.trim()},set:function(e){this.codeTarget.value=e}}])&&function(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(n.prototype,i),n}(e.Controller);return r.targets=["code","resultText","resultIcon"],e.Application.start().register("coupon-code",r),{start:function(){console.log("Spree Frontend initialized")}}});
//# sourceMappingURL=spree_frontend.umd.js.map
