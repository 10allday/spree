import{Controller as e,Application as t}from"stimulus";import{makeClient as r}from"@spree/storefront-api-v2-sdk";import"@spree/storefront-api-v2-sdk/dist/client";class s extends e{get code(){return this.codeTarget.value.trim()}set code(e){this.codeTarget.value=e}initialize(){this.apiClient=r({host:window.SpreeAPI.storefrontHost})}async apply(){if(!this.code)return;const e=window.SpreeAPI.orderToken,t=await this.apiClient.cart.applyCouponCode({orderToken:e},{coupon_code:this.code});this.handleResponse(t)}async remove(){if(!this.code)return;const e=window.SpreeAPI.orderToken,t=await this.apiClient.cart.removeCouponCode({orderToken:e},this.code);this.handleResponse(t)}handleResponse(e){e.isFail()?this.handleError(e.fail().serverResponse.data.error):this.handleSuccess()}handleError(e){this.code=null,this.element.classList.add("error"),this.resultTextTarget.classList.add("alert-error"),this.resultTextTarget.innerHTML=e,this.resultIconTarget.src=Spree.translations.coupon_code_error_icon}handleSuccess(){this.code=null,this.element.classList.remove("error"),this.resultTextTarget.classList.remove("alert-error"),this.resultIconTarget.remove(),this.resultTextTarget.classList.add("alert-success"),this.resultTextTarget.innerHTML=Spree.translations.coupon_code_applied,window.location.reload()}}s.targets=["code","resultText","resultIcon"],t.start().register("coupon-code",s);var o={start(){console.log("Spree Frontend initialized")}};export default o;
//# sourceMappingURL=spree_frontend.modern.js.map
