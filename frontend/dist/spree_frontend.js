var e=require("stimulus");function r(e,t){return(r=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,t)}require("@spree/storefront-api-v2-sdk/dist/client");var t=function(e){var t,o;function n(){return e.apply(this,arguments)||this}o=e,(t=n).prototype=Object.create(o.prototype),t.prototype.constructor=t,r(t,o);var s,i=n.prototype;return i.initialize=function(){this.apiClient=window.SpreeSDK.makeClient({host:window.SpreeAPI.storefrontHost})},i.apply=function(){try{var e=this;if(!e.code)return Promise.resolve();var r=window.SpreeAPI.orderToken;return Promise.resolve(e.apiClient.cart.applyCouponCode({orderToken:r},{coupon_code:e.code})).then(function(r){e.handleResponse(r)})}catch(e){return Promise.reject(e)}},i.remove=function(){try{var e=this;if(!e.code)return Promise.resolve();var r=window.SpreeAPI.orderToken;return Promise.resolve(e.apiClient.cart.removeCouponCode({orderToken:r},e.code)).then(function(r){e.handleResponse(r)})}catch(e){return Promise.reject(e)}},i.handleResponse=function(e){e.isFail()?this.handleError(e.fail().serverResponse.data.error):this.handleSuccess()},i.handleError=function(e){this.code=null,this.element.classList.add("error"),this.resultTextTarget.classList.add("alert-error"),this.resultTextTarget.innerHTML=e,this.resultIconTarget.src=Spree.translations.coupon_code_error_icon},i.handleSuccess=function(){this.code=null,this.element.classList.remove("error"),this.resultTextTarget.classList.remove("alert-error"),this.resultIconTarget.remove(),this.resultTextTarget.classList.add("alert-success"),this.resultTextTarget.innerHTML=Spree.translations.coupon_code_applied,window.location.reload()},(s=[{key:"code",get:function(){return this.codeTarget.value.trim()},set:function(e){this.codeTarget.value=e}}])&&function(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(n.prototype,s),n}(e.Controller);t.targets=["code","resultText","resultIcon"],e.Application.start().register("coupon-code",t),module.exports={start:function(){console.log("Spree Frontend initialized")}};
//# sourceMappingURL=spree_frontend.js.map
