{"version":3,"file":"spree_frontend.modern.js","sources":["../app/javascript/controllers/coupon_code_controller.js","../app/javascript/index.js"],"sourcesContent":["import { Controller } from \"stimulus\";\n\nexport default class extends Controller {\n  static targets = [\"code\", \"resultText\", \"resultIcon\"];\n\n  get code() {\n    return this.codeTarget.value.trim();\n  }\n\n  set code(value) {\n    this.codeTarget.value = value;\n  }\n\n  initialize() {\n    this.apiClient = window.SpreeSDK.makeClient({\n      host: window.SpreeAPI.storefrontHost,\n    });\n  }\n\n  async apply() {\n    if (!this.code) return;\n\n    const orderToken = window.SpreeAPI.orderToken;\n\n    const response = await this.apiClient.cart.applyCouponCode(\n      { orderToken },\n      {\n        coupon_code: this.code,\n      }\n    );\n\n    this.handleResponse(response);\n  }\n\n  async remove() {\n    if (!this.code) return;\n\n    const orderToken = window.SpreeAPI.orderToken;\n\n    const response = await this.apiClient.cart.removeCouponCode(\n      { orderToken },\n      this.code\n    );\n\n    this.handleResponse(response);\n  }\n\n  handleResponse(response) {\n    if (response.isFail()) {\n      this.handleError(response.fail().serverResponse.data.error);\n    } else {\n      this.handleSuccess();\n    }\n  }\n\n  handleError(error) {\n    this.code = null;\n    this.element.classList.add(\"error\");\n    this.resultTextTarget.classList.add(\"alert-error\");\n    this.resultTextTarget.innerHTML = error;\n    this.resultIconTarget.src = Spree.translations.coupon_code_error_icon;\n  }\n\n  handleSuccess() {\n    this.code = null;\n    this.element.classList.remove(\"error\");\n    this.resultTextTarget.classList.remove(\"alert-error\");\n    this.resultIconTarget.remove();\n    this.resultTextTarget.classList.add(\"alert-success\");\n    this.resultTextTarget.innerHTML = Spree.translations.coupon_code_applied;\n    window.location.reload();\n  }\n}\n","import { Application } from \"stimulus\"\nimport * as Controllers from './controllers'\nimport '@spree/storefront-api-v2-sdk/dist/client'\n\nconst application = Application.start()\napplication.register('coupon-code', Controllers.CouponCodeController)\n\nexport default {\n  start() {\n    console.log('Spree Frontend initialized')\n  }\n}\n\n"],"names":["Controller","code","codeTarget","value","trim","this","initialize","apiClient","window","SpreeSDK","makeClient","host","SpreeAPI","storefrontHost","[object Object]","orderToken","response","cart","applyCouponCode","coupon_code","handleResponse","removeCouponCode","isFail","handleError","fail","serverResponse","data","error","handleSuccess","element","classList","add","resultTextTarget","innerHTML","resultIconTarget","src","Spree","translations","coupon_code_error_icon","remove","coupon_code_applied","location","reload","targets","Application","start","register","Controllers","console","log"],"mappings":"wHAE6BA,EAGnBC,WACN,YAAYC,WAAWC,MAAMC,OAGvBH,SAACE,GACPE,KAAKH,WAAWC,MAAQA,EAG1BG,aACED,KAAKE,UAAYC,OAAOC,SAASC,WAAW,CAC1CC,KAAMH,OAAOI,SAASC,iBAIfC,cACT,IAAKT,KAAKJ,KAAM,OAEhB,MAAMc,EAAaP,OAAOI,SAASG,WAE7BC,aAAsBT,UAAUU,KAAKC,gBACzC,CAAEH,WAAAA,GACF,CACEI,YAAad,KAAKJ,OAItBI,KAAKe,eAAeJ,GAGVF,eACV,IAAKT,KAAKJ,KAAM,OAEhB,MAAMc,EAAaP,OAAOI,SAASG,WAE7BC,aAAsBT,UAAUU,KAAKI,iBACzC,CAAEN,WAAAA,GACFV,KAAKJ,MAGPI,KAAKe,eAAeJ,GAGtBI,eAAeJ,GACTA,EAASM,SACXjB,KAAKkB,YAAYP,EAASQ,OAAOC,eAAeC,KAAKC,OAErDtB,KAAKuB,gBAITL,YAAYI,GACVtB,KAAKJ,KAAO,KACZI,KAAKwB,QAAQC,UAAUC,IAAI,SAC3B1B,KAAK2B,iBAAiBF,UAAUC,IAAI,eACpC1B,KAAK2B,iBAAiBC,UAAYN,EAClCtB,KAAK6B,iBAAiBC,IAAMC,MAAMC,aAAaC,uBAGjDV,gBACEvB,KAAKJ,KAAO,KACZI,KAAKwB,QAAQC,UAAUS,OAAO,SAC9BlC,KAAK2B,iBAAiBF,UAAUS,OAAO,eACvClC,KAAK6B,iBAAiBK,SACtBlC,KAAK2B,iBAAiBF,UAAUC,IAAI,iBACpC1B,KAAK2B,iBAAiBC,UAAYG,MAAMC,aAAaG,oBACrDhC,OAAOiC,SAASC,YAnEXC,QAAU,CAAC,OAAQ,aAAc,cCCtBC,EAAYC,QACpBC,SAAS,cAAeC,GAEpC,MAAe,CACbF,QACEG,QAAQC,IAAI"}