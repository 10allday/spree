{"version":3,"file":"spree_frontend.modern.js","sources":["../app/javascript/controllers/coupon_code_controller.js","../app/javascript/index.js"],"sourcesContent":["import { Controller } from 'stimulus'\nimport { makeClient } from '@spree/storefront-api-v2-sdk'\n\nexport default class extends Controller {\n  static targets = [ 'code', 'resultText', 'resultIcon' ]\n\n  get code() {\n    return this.codeTarget.value.trim()\n  }\n\n  set code(value) {\n    this.codeTarget.value = value\n  }\n\n  initialize() {\n    this.apiClient = makeClient({\n      host: window.SpreeAPI.storefrontHost\n    })\n  }\n\n  async apply() {\n    if (!this.code) return\n\n    const orderToken = window.SpreeAPI.orderToken\n\n    const response = await this.apiClient.cart.applyCouponCode({ orderToken }, {\n      coupon_code: this.code\n    })\n\n    this.handleResponse(response)\n  }\n\n  async remove() {\n    if (!this.code) return\n\n    const orderToken = window.SpreeAPI.orderToken\n\n    const response = await this.apiClient.cart.removeCouponCode({ orderToken }, this.code)\n\n    this.handleResponse(response)\n  }\n\n  handleResponse(response) {\n    if (response.isFail()) {\n      this.handleError(response.fail().serverResponse.data.error)\n    } else {\n      this.handleSuccess()\n    }\n  }\n\n  handleError(error) {\n    this.code = null\n    this.element.classList.add('error')\n    this.resultTextTarget.classList.add('alert-error')\n    this.resultTextTarget.innerHTML = error\n    this.resultIconTarget.src = Spree.translations.coupon_code_error_icon\n  }\n\n  handleSuccess() {\n    this.code = null\n    this.element.classList.remove('error')\n    this.resultTextTarget.classList.remove('alert-error')\n    this.resultIconTarget.remove()\n    this.resultTextTarget.classList.add('alert-success')\n    this.resultTextTarget.innerHTML = Spree.translations.coupon_code_applied\n    window.location.reload()\n  }\n}\n","import { Application } from \"stimulus\"\nimport * as Controllers from './controllers'\nimport '@spree/storefront-api-v2-sdk/dist/client'\n\nconst application = Application.start()\napplication.register('coupon-code', Controllers.CouponCodeController)\n\nexport default {\n  start() {\n    console.log('Spree Frontend initialized')\n  }\n}\n\n"],"names":["Controller","code","codeTarget","value","trim","this","initialize","apiClient","makeClient","host","window","SpreeAPI","storefrontHost","[object Object]","orderToken","response","cart","applyCouponCode","coupon_code","handleResponse","removeCouponCode","isFail","handleError","fail","serverResponse","data","error","handleSuccess","element","classList","add","resultTextTarget","innerHTML","resultIconTarget","src","Spree","translations","coupon_code_error_icon","remove","coupon_code_applied","location","reload","targets","Application","start","register","Controllers","console","log"],"mappings":"kLAG6BA,EAGnBC,WACN,YAAYC,WAAWC,MAAMC,OAGvBH,SAACE,GACPE,KAAKH,WAAWC,MAAQA,EAG1BG,aACED,KAAKE,UAAYC,EAAW,CAC1BC,KAAMC,OAAOC,SAASC,iBAIfC,cACT,IAAKR,KAAKJ,KAAM,OAEhB,MAAMa,EAAaJ,OAAOC,SAASG,WAE7BC,aAAsBR,UAAUS,KAAKC,gBAAgB,CAAEH,WAAAA,GAAc,CACzEI,YAAab,KAAKJ,OAGpBI,KAAKc,eAAeJ,GAGVF,eACV,IAAKR,KAAKJ,KAAM,OAEhB,MAAMa,EAAaJ,OAAOC,SAASG,WAE7BC,aAAsBR,UAAUS,KAAKI,iBAAiB,CAAEN,WAAAA,GAAcT,KAAKJ,MAEjFI,KAAKc,eAAeJ,GAGtBI,eAAeJ,GACTA,EAASM,SACXhB,KAAKiB,YAAYP,EAASQ,OAAOC,eAAeC,KAAKC,OAErDrB,KAAKsB,gBAITL,YAAYI,GACVrB,KAAKJ,KAAO,KACZI,KAAKuB,QAAQC,UAAUC,IAAI,SAC3BzB,KAAK0B,iBAAiBF,UAAUC,IAAI,eACpCzB,KAAK0B,iBAAiBC,UAAYN,EAClCrB,KAAK4B,iBAAiBC,IAAMC,MAAMC,aAAaC,uBAGjDV,gBACEtB,KAAKJ,KAAO,KACZI,KAAKuB,QAAQC,UAAUS,OAAO,SAC9BjC,KAAK0B,iBAAiBF,UAAUS,OAAO,eACvCjC,KAAK4B,iBAAiBK,SACtBjC,KAAK0B,iBAAiBF,UAAUC,IAAI,iBACpCzB,KAAK0B,iBAAiBC,UAAYG,MAAMC,aAAaG,oBACrD7B,OAAO8B,SAASC,YA7DXC,QAAU,CAAE,OAAQ,aAAc,cCAvBC,EAAYC,QACpBC,SAAS,cAAeC,GAEpC,MAAe,CACbF,QACEG,QAAQC,IAAI"}